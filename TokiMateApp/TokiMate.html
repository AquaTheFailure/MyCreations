<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TokiMate</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
<style>
* {margin:0; padding:0; box-sizing:border-box; font-family: 'Inter', sans-serif;}
html, body {height:100%; overflow:hidden;}

body {
  background: url("https://mir-s3-cdn-cf.behance.net/project_modules/max_1200/de917977268563.5c829061be1d3.gif") center/cover no-repeat;
  display:flex; justify-content:center; align-items:center; flex-direction:column;
  color:white; transition:background 0.5s, opacity 1s ease-in-out;
  opacity: 0;
}

#clockContainer {
  position: relative; cursor:pointer; padding:50px 80px; border-radius:40px;
  background: rgba(255,255,255,0.1); backdrop-filter: blur(20px);
  box-shadow: 0 20px 60px rgba(0,0,0,0.4);
  display:flex; flex-direction:column; justify-content:center; align-items:center; transition: transform 0.3s;
}
#clockContainer:hover {transform:scale(1.05);}
#clock {font-size:100px; font-weight:700; text-shadow:0 0 20px rgba(0,0,0,0.5),0 0 10px rgba(255,255,255,0.2);}
#welcomeName {margin-top:10px; font-size:24px; font-weight:500; opacity:0.85; text-shadow:0 0 10px rgba(0,0,0,0.3);}

#analogClock {display:none; position:relative; width:220px; height:220px; border:10px solid rgba(255,255,255,0.6); border-radius:50%; background: rgba(255,255,255,0.05); box-shadow:0 0 40px rgba(255,255,255,0.2) inset;}
.hand {position:absolute; width:50%; height:4px; background:white; top:50%; transform-origin:100%; transform:rotate(90deg); transition: transform 0.5s ease-in-out;}
.hourHand {height:6px;} .minuteHand {height:4px;} .secondHand {height:2px; background:#f43f5e;}

#settingsPanel {
  position: fixed; top:0; right:-400px; height:100%; width:400px;
  background: rgba(0,0,0,0.85); backdrop-filter: blur(20px);
  padding:30px; border-left:1px solid rgba(255,255,255,0.1);
  box-shadow: -5px 0 30px rgba(0,0,0,0.5); color:white; transition: right 0.4s ease;
  overflow-y:auto; z-index:20;
}
#settingsPanel.active { right:0; }
label {display:block; margin:15px 0 5px; font-weight:500;}
select {width:100%; margin-bottom:10px; padding:8px; border-radius:10px; border:none; background: rgba(255,255,255,0.9); color:black; font-weight:500;}

#iframeView {position:absolute; top:0; left:0; width:100%; height:100%; border:none; display:none; z-index:10; background:white;}

#creditsView {
  display:none; position:absolute; top:0; left:0; width:100%; height:100%;
  background: rgba(0,0,0,0.95); color:white; z-index:15;
  overflow:auto; padding:50px; box-sizing:border-box; transition: opacity 0.3s ease;
}
#creditsView h1 { font-size: 36px; margin-bottom:20px;}
#creditsView ul { margin-left:20px; }
#creditsView button { position:absolute; top:20px; right:20px; padding:10px 15px; font-size:16px; border:none; border-radius:10px; background:#f43f5e; color:white; cursor:pointer;}

#dock {
  position: fixed; bottom:30px; left:50%; transform:translateX(-50%);
  display:flex; gap:20px; align-items:flex-end; padding:15px 25px;
  border-radius:40px; background: rgba(255,255,255,0.15); backdrop-filter: blur(25px);
  box-shadow:0 10px 40px rgba(0,0,0,0.4); z-index:10;
}
.dock-app { flex:0 0 auto; width:70px; height:70px; border-radius:20px;
  display:flex; flex-direction:column; justify-content:center; align-items:center; font-size:30px; color:#333; cursor:pointer;
  transition: transform 0.2s ease, box-shadow 0.2s ease; position:relative;
}
.dock-app:hover { transform: scale(1.08); box-shadow:0 10px 25px rgba(0,0,0,0.4);}
.dock-app img { width:48px; height:48px; pointer-events:none; object-fit:contain; }
.dock-label { font-size:13px; color:white; opacity:0.9; margin-top:5px; text-shadow:0 1px 5px rgba(0,0,0,0.3); }

/* App icon backgrounds */
.app-light { background: rgba(255,255,255,0.9); }
.app-mirror { background: rgba(255,255,255,0.3); backdrop-filter: blur(5px); }
.app-black { background: rgba(0,0,0,0.7); }

/* Small Home button */
#homeBtn {
  position: fixed; bottom:20px; left:20px; width:50px; height:50px;
  border-radius:50%; background: rgba(255,255,255,0.2); border:none; color:white; font-size:24px; cursor:pointer; display:none; z-index:25;
  display:none; overflow:visible;
  transition: transform .25s cubic-bezier(.2,.9,.2,1), box-shadow .25s ease, background-color .25s ease;
  will-change: transform, box-shadow;
}
#homeBtn img { transition: transform .25s ease; display:block; width:28px; height:28px; margin:auto; }

#homeBtn:hover{
  transform: translateY(-6px) scale(1.08);
  box-shadow: 0 12px 30px rgba(79,70,229,0.18), 0 4px 10px rgba(0,0,0,0.35), 0 0 14px rgba(244,63,94,0.10);
  background: linear-gradient(180deg, rgba(255,255,255,0.22), rgba(255,255,255,0.12));
}
#homeBtn:hover img{ transform: rotate(-8deg) scale(1.04); }

/* Subtle glowing ring animation */
#homeBtn::after{
  content: "";
  position: absolute;
  left: 50%; top: 50%;
  width: 90%; height: 90%;
  transform: translate(-50%,-50%) scale(1);
  border-radius: 50%;
  pointer-events: none;
  z-index: -1;
  background: radial-gradient(circle at center, rgba(79,70,229,0.18) 0%, rgba(244,63,94,0.06) 35%, transparent 60%);
  opacity: 0;
  transition: opacity .25s ease, transform .4s ease;
}
#homeBtn:hover::after{
  opacity: 1;
  transform: translate(-50%,-50%) scale(1.45);
  animation: pulseRing 900ms ease-out;
}

@keyframes pulseRing {
  0%   { transform: translate(-50%,-50%) scale(1);   opacity: .9;  }
  60%  { transform: translate(-50%,-50%) scale(1.9); opacity: .18; }
  100% { transform: translate(-50%,-50%) scale(2.6); opacity: 0;   }
}

/* Name prompt modal */
#namePrompt {
  position:fixed; top:0; left:0; width:100%; height:100%;
  background: rgba(0,0,0,0.6); backdrop-filter: blur(10px);
  display:flex; justify-content:center; align-items:center; z-index:50;
}
#nameBox {
  background: rgba(255,255,255,0.15); padding:40px; border-radius:30px;
  backdrop-filter: blur(20px); text-align:center; box-shadow:0 10px 40px rgba(0,0,0,0.4);
}
#nameBox h2 {margin-bottom:15px; color:white;}
#nameInput {padding:10px 15px; border:none; border-radius:10px; width:80%; font-size:16px; margin-bottom:15px;}
#saveNameBtn {padding:10px 20px; border:none; border-radius:10px; background:#4f46e5; color:white; cursor:pointer;}

/* Spotlight search */
#searchContainer {
  position:fixed;top:30px;left:50%;transform:translateX(-50%);z-index:50;width:400px;
}
#appSearch {
  width:100%;padding:10px 15px;border-radius:20px;border:none;font-size:16px;outline:none;
  box-shadow:0 5px 20px rgba(0,0,0,0.3);backdrop-filter: blur(10px);background:rgba(255,255,255,0.15);color:white;
}
#searchSuggestions {
  margin-top:5px;background:rgba(0,0,0,0.7);border-radius:10px;display:none;max-height:200px;overflow-y:auto;
}
#searchSuggestions div {Padding:8px 12px;cursor:pointer;color:white;}
#searchSuggestions div:hover {background:rgba(255,255,255,0.2);}

/* Room Code Popup (initially hidden) */
#roomPrompt {
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  background: rgba(0,0,0,0.55); backdrop-filter: blur(8px);
  display: none; justify-content: center; align-items: center;
  z-index: 100;
}
#roomBox {
  background: rgba(255,255,255,0.15); padding: 35px; border-radius: 25px;
  backdrop-filter: blur(20px); text-align: center;
  box-shadow: 0 10px 40px rgba(0,0,0,0.4);
}
#roomBox h2 { color: white; margin-bottom: 15px; }
#roomInput {
  width: 80%; padding: 10px;
  border-radius: 10px; border: none; margin-bottom: 20px;
}
.roomBtn {
  padding: 10px 20px; border: none; border-radius: 10px;
  margin: 5px; cursor: pointer; font-weight: 600;
}
#joinRoomBtn { background: #4ade80; color: black; }
#cancelRoomBtn { background: #f87171; color: white; }
</style>
</head>
<body>

<div id="clockContainer">
  <div id="clock">00:00:00</div>
  <div id="analogClock">
    <div class="hand hourHand"></div>
    <div class="hand minuteHand"></div>
    <div class="hand secondHand"></div>
  </div>
  <div id="welcomeName"></div>
</div>

<!-- Name prompt -->
<div id="namePrompt" style="display:none;">
  <div id="nameBox">
    <h2>Welcome! What's your name?</h2>
    <input type="text" id="nameInput" placeholder="Enter your name">
    <br>
    <button id="saveNameBtn">Save</button>
  </div>
</div>

<div id="settingsPanel">
  <h2 style="display:flex; align-items:center; gap:10px;">
    <img src="https://raw.githubusercontent.com/AquaTheFailure/MyCreations/refs/heads/main/TokiMateApp/Utilities/Icons/settings.svg" alt="Settings Logo" style="width:30px; height:30px;">
    Settings
  </h2>
  <label>Timezone:
    <select id="timezoneSelect">
      <option value="America/Chicago">Anna, Texas</option>
      <option value="UTC">UTC</option>
      <option value="America/New_York">New York</option>
      <option value="Europe/London">London</option>
      <option value="Asia/Tokyo">Tokyo</option>
    </select>
  </label>
  <label>Clock Format:
    <select id="formatSelect">
      <option value="12">12-hour</option>
      <option value="24">24-hour</option>
    </select>
  </label>
  <label>Clock Style:
    <select id="styleSelect">
      <option value="digital">Digital</option>
      <option value="analog">Analog</option>
    </select>
  </label>
  <label>Background:
    <select id="backgroundSelect">
      <option value="digitalLandscape">Digital Landscape</option>
      <option value="gradient1">Gradient 1</option>
      <option value="gradient2">Gradient 2</option>
      <option value="gradient3">Gradient 3</option>
    </select>
  </label>
  <label>App Icon Style:
    <select id="appStyleSelect">
      <option value="light">Light</option>
      <option value="mirror">Mirror</option>
      <option value="black">Black</option>
    </select>
  </label>
</div>

<iframe id="iframeView"></iframe>

<div id="creditsView">
  <h1>Credits</h1>
  <p>Special thanks to everyone who contributed:</p>
  <ul>
    <li>Emilio ‚Äì SVG design</li>
    <li>Tsukki ‚Äì Concept and Implementation</li>
  </ul>
  <p>Made using HTML, CSS, and JavaScript. <br><br> Please Reload After Closing This.</p>
  <button id="closeCredits">Close</button>
</div>

<!-- Spotlight Search -->
<div id="searchContainer">
  <input type="text" id="appSearch" placeholder="Type to search apps...">
  <div id="searchSuggestions"></div>
</div>

<!-- Bottom dock -->
<div id="dock">
  <div class="dock-app app-light" data-app="Browser" data-url="TokiMate://Browser" title="Browser">üñ•Ô∏è</div>
  <div class="dock-app app-light" data-app="Mail" data-url="TokiMate://Mail" title="Mail">üìß</div>
  <div class="dock-app app-light" data-app="Music" data-url="TokiMate://Music" title="Music">
    <img src="https://raw.githubusercontent.com/AquaTheFailure/MyCreations/refs/heads/main/TokiMateApp/Utilities/Icons/music_player.svg" alt="Music" style="width:48px;height:48px;pointer-events:none;object-fit:contain;">
  </div>
  <div class="dock-app app-light" data-app="Photos" data-url="TokiMate://Photos" title="Photos">
    <img src="https://raw.githubusercontent.com/AquaTheFailure/MyCreations/refs/heads/main/TokiMateApp/Utilities/Icons/Pictures_icon.svg" alt="Photos" style="width:48px;height:48px;pointer-events:none;object-fit:contain;">
  </div>
  <div class="dock-app app-light" data-app="Skribbl" data-url="TokiMate://Skribbl" title="Skribbl">
    <img src="https://raw.githubusercontent.com/AquaTheFailure/MyCreations/refs/heads/main/TokiMateApp/Utilities/Icons/Skribbl_icon.svg" alt="Skribbl" style="width:48px;height:48px;pointer-events:none;object-fit:contain;">
  </div>
  <div class="dock-app app-light" data-app="Credits" data-url="credits" title="Credits">‚ÑπÔ∏è</div>
</div>

<button id="homeBtn" title="Home">
  <img src="https://raw.githubusercontent.com/AquaTheFailure/MyCreations/refs/heads/main/TokiMateApp/Utilities/Icons/Home_icon.svg" alt="Home" style="width:28px;height:28px;display:block;margin:auto;">
</button>

<!-- Room Code Prompt -->
<div id="roomPrompt" style="display:none;">
  <div id="roomBox">
    <h2>Join a Skribbl Room</h2>
    <input id="roomInput" type="text" placeholder="Enter room code (optional)">
    <br>
    <button class="roomBtn" id="joinRoomBtn">Join</button>
    <button class="roomBtn" id="cancelRoomBtn">Cancel</button>
  </div>
</div>

<script>
window.addEventListener('load', () => document.body.style.opacity = '1');

// Clock and Analog Hands
const clock=document.getElementById('clock');
const analogClock=document.getElementById('analogClock');
const hourHand=analogClock.querySelector('.hourHand');
const minuteHand=analogClock.querySelector('.minuteHand');
const secondHand=analogClock.querySelector('.secondHand');

const clockContainer=document.getElementById('clockContainer');
const settingsPanel=document.getElementById('settingsPanel');
const timezoneSelect=document.getElementById('timezoneSelect');
const formatSelect=document.getElementById('formatSelect');
const styleSelect=document.getElementById('styleSelect');
const backgroundSelect=document.getElementById('backgroundSelect');
const appStyleSelect=document.getElementById('appStyleSelect');
const iframeView=document.getElementById('iframeView');
const dock=document.getElementById('dock');
// FIX: ensure dockApps is defined before use
const dockApps=document.querySelectorAll('.dock-app');
const homeBtn=document.getElementById('homeBtn');
const creditsView=document.getElementById('creditsView');
const closeCreditsBtn=document.getElementById('closeCredits');
const welcomeName=document.getElementById('welcomeName');
const namePrompt=document.getElementById('namePrompt');
const nameInput=document.getElementById('nameInput');
const saveNameBtn=document.getElementById('saveNameBtn');

const appSearch=document.getElementById('appSearch');
const searchSuggestions=document.getElementById('searchSuggestions');

let userName=localStorage.getItem('userName');
if(!userName){namePrompt.style.display='flex';}else{welcomeName.textContent=`Welcome, ${userName}!`;}

saveNameBtn.addEventListener('click',()=>{
  const val=nameInput.value.trim();
  if(val){localStorage.setItem('userName',val);userName=val;welcomeName.textContent=`Welcome, ${userName}!`;namePrompt.style.display='none';}
});

// Settings
let settings={timezone:'America/Chicago',format:'24',style:'digital',background:'digitalLandscape',appStyle:'light'};
const savedSettings=localStorage.getItem('desktopSettings');if(savedSettings){settings={...settings,...JSON.parse(savedSettings)};}

timezoneSelect.value=settings.timezone;formatSelect.value=settings.format;styleSelect.value=settings.style;
backgroundSelect.value=settings.background;appStyleSelect.value=settings.appStyle;

function updateClock(){
  const now=new Date();
  const options={timeZone:settings.timezone,hour12:settings.format==='12',hour:'2-digit',minute:'2-digit',second:'2-digit'};
  clock.textContent=now.toLocaleTimeString('en-US',options);
  const local=new Date(now.toLocaleString('en-US',{timeZone:settings.timezone}));
  const h=local.getHours()%12,m=local.getMinutes(),s=local.getSeconds();
  hourHand.style.transform=`rotate(${h*30+m/2}deg)`;minuteHand.style.transform=`rotate(${m*6}deg)`;secondHand.style.transform=`rotate(${s*6}deg)`;
}
setInterval(updateClock,1000);updateClock();

const gifBackgrounds = [
  "https://images.steamusercontent.com/ugc/271725310716427808/FA3288AF961AFFFDC71DB99058354F1159943C09/?imw=5000&imh=5000&ima=fit&impolicy=Letterbox&imcolor=%23000000&letterbox=false",
  "https://windowscustomization.com/wp-content/uploads/2019/02/Wallpaper.gif",
  "https://windowscustomization.com/wp-content/uploads/2018/12/Anime-And-Scape-Watefal.gif",
  "https://wallpaperaccess.com/full/9336992.gif"
];

function applySettings(){
  localStorage.setItem('desktopSettings', JSON.stringify(settings));
  clock.style.display = settings.style === 'digital' ? 'block' : 'none';
  analogClock.style.display = settings.style === 'analog' ? 'block' : 'none';
  const b = settings.background;
  document.body.style.transition = 'background 0.8s ease-in-out, opacity 0.8s ease-in-out';
  document.body.style.backgroundAttachment = 'fixed';
  if (b === 'digitalLandscape') {
    const randomGif = gifBackgrounds[Math.floor(Math.random() * gifBackgrounds.length)];
    document.body.style.background = `url('${randomGif}') center/cover no-repeat fixed`;
  } else if (b === 'gradient1') {
    document.body.style.background = "linear-gradient(135deg,#667eea,#764ba2)";
  } else if (b === 'gradient2') {
    document.body.style.background = "linear-gradient(135deg,#ff9a9e,#fad0c4)";
  } else if (b === 'gradient3') {
    document.body.style.background = "linear-gradient(135deg,#43cea2,#185a9d)";
  }
  dockApps.forEach(app => {
    app.classList.remove('app-light','app-mirror','app-black');
    app.classList.add(`app-${settings.appStyle}`);
  });
}
applySettings();

[timezoneSelect,formatSelect,styleSelect,backgroundSelect,appStyleSelect].forEach(sel=>{
  sel.addEventListener('change',()=>{settings[sel.id.replace('Select','')]=sel.value;applySettings();});
});


let apps = [];

// Load external JSON
fetch("https://raw.githubusercontent.com/AquaTheFailure/MyCreations/refs/heads/main/TokiMateApp/apps.json")
  .then(res => res.json())
  .then(data => apps = data)
  .catch(err => console.error("Could not load apps.json:", err));

// Return app URL from JSON
function getAppURL(appName) {
  const app = apps.find(a => a.name.toLowerCase() === appName.toLowerCase());
  return app ? app.url : "";
}

// App opener
function openApp(url) {
  if (url === 'credits') {
    creditsView.style.display = 'block';
    dock.style.display = 'none';
    clockContainer.style.display = 'none';
    settingsPanel.style.display = 'none';
    appSearch.parentElement.style.display = 'none';
    homeBtn.style.display = 'block';
    return;
  }

  if (url.startsWith('TokiMate://')) {
    const appName = url.replace('TokiMate://', '');
    iframeView.src = getAppURL(appName);
    iframeView.style.display = 'block';
    homeBtn.style.display = 'block';
    dock.style.display = 'none';
    clockContainer.style.display = 'none';
    settingsPanel.style.display = 'none';
    appSearch.parentElement.style.display = 'none';
  }
}

// FIX: Intercept Skribbl opening on dock apps ‚Äî dockApps is defined above
dockApps.forEach(app=>{
  app.addEventListener('click',()=>{
    if(app.dataset.app === 'Skribbl'){
      // Show room popup
      document.getElementById('roomPrompt').style.display = 'flex';
      return;
    }
    openApp(app.dataset.url);
  });
});

// Home button restores everything
homeBtn.addEventListener('click',()=>{
  iframeView.style.display='none';
  homeBtn.style.display='none';
  dock.style.display = 'flex';
  clockContainer.style.display = 'flex';
  appSearch.parentElement.style.display = 'block';
});

// Credits close
closeCreditsBtn.addEventListener('click', () => {
    creditsView.style.display = 'none';
    // Restore main UI elements
    clockContainer.style.display = 'flex';
    dock.style.display = 'flex';
    document.getElementById('searchContainer').style.display = 'block';
    iframeView.style.display = 'none';
    homeBtn.style.display = 'none';
});

// Settings toggle
clockContainer.addEventListener('click', () => {
    // Only toggle settings if iframe is not open
    if (iframeView.style.display !== 'block') {
        settingsPanel.classList.toggle('active');
    }
});

// Spotlight search
appSearch.addEventListener('input', () => {
  const val = appSearch.value.toLowerCase().trim();
  searchSuggestions.innerHTML = '';
  if(val.length === 0){searchSuggestions.style.display='none'; return;}

  const filtered = apps.filter(app => app.name.toLowerCase().includes(val));
  if(filtered.length === 0){searchSuggestions.style.display='none'; return;}

  filtered.forEach(app => {
    const div = document.createElement('div');
    div.textContent = app.name;
    div.addEventListener('click', () => {
      // Autofill with TokiMate:// prefix
      appSearch.value = `TokiMate://${app.name}`;
      searchSuggestions.style.display='none';
    });
    searchSuggestions.appendChild(div);
  });
  searchSuggestions.style.display='block';
});

appSearch.addEventListener('keydown', e => {
  if(e.key==='Enter'){
    const val = appSearch.value.trim();
    // Only open if starts with TokiMate://
    if(val.startsWith('TokiMate://')){
      const appName = val.replace('TokiMate://','');
      const match = apps.find(a=>a.name.toLowerCase()===appName.toLowerCase());
      if(match) openApp(match.redirect);
    }
    searchSuggestions.style.display='none';
  }
});

// Room prompt elements
const roomPrompt = document.getElementById('roomPrompt');
const roomInput = document.getElementById('roomInput');
const joinRoomBtn = document.getElementById('joinRoomBtn');
const cancelRoomBtn = document.getElementById('cancelRoomBtn');

// Join button ‚Üí uses roomInput
joinRoomBtn.addEventListener('click', () => {
  const code = roomInput.value.trim();
  let link = 'https://skribbl.io';

  if(code !== ''){
    link = `https://skribbl.io/?${code}`;
  }

  roomPrompt.style.display = 'none';
  roomInput.value = '';

  iframeView.src = link;
  iframeView.style.display = 'block';
  homeBtn.style.display = 'block';
  dock.style.display = 'none';
  clockContainer.style.display = 'none';
  settingsPanel.style.display = 'none';
  appSearch.parentElement.style.display = 'none';
});

// Cancel button ‚Üí open normal skribbl.io
cancelRoomBtn.addEventListener('click', () => {
  roomPrompt.style.display = 'none';

  iframeView.src = 'https://skribbl.io';
  iframeView.style.display = 'block';
  homeBtn.style.display = 'block';
  dock.style.display = 'none';
  clockContainer.style.display = 'none';
  settingsPanel.style.display = 'none';
  appSearch.parentElement.style.display = 'none';
});


// === Skribbl Room Code Popup (alternate nicer prompt) ===
// If you prefer the animated JS-created overlay approach, you can use the functions below.
// They won't be used automatically because the static #roomPrompt works fine ‚Äî they remain here
// as an option and are safe because they reference dockApps which is defined above.

function promptSkribblRoom() {
  return new Promise((resolve) => {
    const overlay = document.createElement('div');
    overlay.style.position = 'fixed';
    overlay.style.top = '0';
    overlay.style.left = '0';
    overlay.style.width = '100%';
    overlay.style.height = '100%';
    overlay.style.background = 'rgba(0,0,0,0.6)';
    overlay.style.backdropFilter = 'blur(10px)';
    overlay.style.display = 'flex';
    overlay.style.justifyContent = 'center';
    overlay.style.alignItems = 'center';
    overlay.style.zIndex = '100';

    const box = document.createElement('div');
    box.style.background = 'rgba(255,255,255,0.15)';
    box.style.padding = '35px';
    box.style.borderRadius = '25px';
    box.style.backdropFilter = 'blur(20px)';
    box.style.textAlign = 'center';
    box.style.color = 'white';
    box.style.width = '350px';
    box.style.boxShadow = '0 10px 40px rgba(0,0,0,0.5)';

    const title = document.createElement('h2');
    title.textContent = 'Join a Skribbl Room';
    title.style.marginBottom = '10px';

    const subtitle = document.createElement('p');
    subtitle.textContent = 'If you have a room code, enter it below:';
    subtitle.style.opacity = '0.85';
    subtitle.style.marginBottom = '20px';

    const input = document.createElement('input');
    input.type = 'text';
    input.placeholder = 'Enter room code';
    input.style.width = '80%';
    input.style.padding = '10px';
    input.style.borderRadius = '10px';
    input.style.border = 'none';
    input.style.marginBottom = '20px';
    input.style.fontSize = '16px';

    const enterBtn = document.createElement('button');
    enterBtn.textContent = 'Join';
    enterBtn.style.padding = '10px 20px';
    enterBtn.style.border = 'none';
    enterBtn.style.borderRadius = '10px';
    enterBtn.style.background = '#4f46e5';
    enterBtn.style.color = 'white';
    enterBtn.style.marginRight = '10px';
    enterBtn.style.cursor = 'pointer';

    const cancelBtn = document.createElement('button');
    cancelBtn.textContent = 'Cancel';
    cancelBtn.style.padding = '10px 20px';
    cancelBtn.style.border = 'none';
    cancelBtn.style.borderRadius = '10px';
    cancelBtn.style.background = '#f43f5e';
    cancelBtn.style.color = 'white';
    cancelBtn.style.cursor = 'pointer';

    box.appendChild(title);
    box.appendChild(subtitle);
    box.appendChild(input);
    box.appendChild(document.createElement('br'));
    box.appendChild(enterBtn);
    box.appendChild(cancelBtn);
    overlay.appendChild(box);
    document.body.appendChild(overlay);

    enterBtn.onclick = () => {
      const value = input.value.trim();
      document.body.removeChild(overlay);
      resolve(value || null);
    };

    cancelBtn.onclick = () => {
      document.body.removeChild(overlay);
      resolve(null);
    };
  });
}

async function handleSkribblLaunch() {
  const code = await promptSkribblRoom();
  if (code) {
    return `https://skribbl.io/?${code}`;
  }
  return "https://skribbl.io";
}

// Modify openApp to detect Skribbl ‚Äî wrap the original in case it's redefined earlier
const _openApp = openApp;
openApp = async function(url) {
  if(url === 'TokiMate://Skribbl'){
    // Use the static room prompt in the DOM (preferred) ~ if you want the programmatic overlay,
    // swap the two lines below.
    document.getElementById('roomPrompt').style.display = 'flex';
    // const finalURL = await handleSkribblLaunch();
    // iframeView.src = finalURL;
    // iframeView.style.display = 'block';
    // homeBtn.style.display = 'block';
    // dock.style.display = 'none';
    // clockContainer.style.display = 'none';
    // settingsPanel.style.display = 'none';
    // appSearch.parentElement.style.display = 'none';
    return;
  }

  // if there was an original openApp function, call it, otherwise use our default
  if(typeof _openApp === 'function') return _openApp(url);
  // fallback behavior
  if(url.startsWith('TokiMate://')){
    const appName = url.replace('TokiMate://','');
    iframeView.src = getAppURL(appName);
    iframeView.style.display='block';
    homeBtn.style.display='block';
    dock.style.display = 'none';
    clockContainer.style.display = 'none';
    settingsPanel.style.display = 'none';
    appSearch.parentElement.style.display = 'none';
  }
};

</script>
</body>
</html>
