<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TokiMate</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
<style>
* {margin:0; padding:0; box-sizing:border-box; font-family: 'Inter', sans-serif;}
html, body {height:100%; overflow:hidden;}

body {
  background: url("https://mir-s3-cdn-cf.behance.net/project_modules/max_1200/de917977268563.5c829061be1d3.gif") center/cover no-repeat;
  display:flex; justify-content:center; align-items:center; flex-direction:column;
  color:white; transition:background 0.5s, opacity 1s ease-in-out;
  opacity: 0;
}

#clockContainer {
  position: relative; cursor:pointer; padding:50px 80px; border-radius:40px;
  background: rgba(255,255,255,0.1); backdrop-filter: blur(20px);
  box-shadow: 0 20px 60px rgba(0,0,0,0.4);
  display:flex; flex-direction:column; justify-content:center; align-items:center; transition: transform 0.3s;
}
#clockContainer:hover {transform:scale(1.05);}
#clock {font-size:100px; font-weight:700; text-shadow:0 0 20px rgba(0,0,0,0.5),0 0 10px rgba(255,255,255,0.2);}
#welcomeName {margin-top:10px; font-size:24px; font-weight:500; opacity:0.85; text-shadow:0 0 10px rgba(0,0,0,0.3);}

#analogClock {display:none; position:relative; width:220px; height:220px; border:10px solid rgba(255,255,255,0.6); border-radius:50%; background: rgba(255,255,255,0.05); box-shadow:0 0 40px rgba(255,255,255,0.2) inset;}
.hand {position:absolute; width:50%; height:4px; background:white; top:50%; transform-origin:100%; transform:rotate(90deg); transition: transform 0.5s ease-in-out;}
.hourHand {height:6px;} .minuteHand {height:4px;} .secondHand {height:2px; background:#f43f5e;}

#settingsPanel {
  position: fixed; top:0; right:-400px; height:100%; width:400px;
  background: rgba(0,0,0,0.85); backdrop-filter: blur(20px);
  padding:30px; border-left:1px solid rgba(255,255,255,0.1);
  box-shadow: -5px 0 30px rgba(0,0,0,0.5); color:white; transition: right 0.4s ease;
  overflow-y:auto; z-index:20;
}
#settingsPanel.active { right:0; }
label {display:block; margin:15px 0 5px; font-weight:500;}
select {width:100%; margin-bottom:10px; padding:8px; border-radius:10px; border:none; background: rgba(255,255,255,0.9); color:black; font-weight:500;}

#iframeView {position:absolute; top:0; left:0; width:100%; height:100%; border:none; display:none; z-index:10; background:white;}

#creditsView {
  display:none; position:absolute; top:0; left:0; width:100%; height:100%;
  background: rgba(0,0,0,0.95); color:white; z-index:15;
  overflow:auto; padding:50px; box-sizing:border-box; transition: opacity 0.3s ease;
}
#creditsView h1 { font-size: 36px; margin-bottom:20px;}
#creditsView ul { margin-left:20px; }
#creditsView button { position:absolute; top:20px; right:20px; padding:10px 15px; font-size:16px; border:none; border-radius:10px; background:#f43f5e; color:white; cursor:pointer;}

#dock {
  position: fixed; bottom:30px; left:50%; transform:translateX(-50%);
  display:flex; gap:20px; align-items:flex-end; padding:15px 25px;
  border-radius:40px; background: rgba(255,255,255,0.15); backdrop-filter: blur(25px);
  box-shadow:0 10px 40px rgba(0,0,0,0.4); z-index:10;
}
.dock-app { flex:0 0 auto; width:70px; height:70px; border-radius:20px;
  display:flex; flex-direction:column; justify-content:center; align-items:center; font-size:30px; color:#333; cursor:pointer;
  transition: transform 0.2s ease, box-shadow 0.2s ease; position:relative;
}
.dock-app:hover { transform: scale(1.08); box-shadow:0 10px 25px rgba(0,0,0,0.4);}
.dock-app img { width:48px; height:48px; pointer-events:none; object-fit:contain; }
.dock-label { font-size:13px; color:white; opacity:0.9; margin-top:5px; text-shadow:0 1px 5px rgba(0,0,0,0.3); }

/* App icon backgrounds */
.app-light { background: rgba(255,255,255,0.9); }
.app-mirror { background: rgba(255,255,255,0.3); backdrop-filter: blur(5px); }
.app-black { background: rgba(0, 0, 0, 0.48); }

/* Small Home button */
#homeBtn {
  position: fixed; bottom:20px; left:20px; width:50px; height:50px;
  border-radius:50%; background: rgba(255,255,255,0.2); border:none; color:white; font-size:24px; cursor:pointer; display:none; z-index:25;
  display:none; overflow:visible;
  transition: transform .25s cubic-bezier(.2,.9,.2,1), box-shadow .25s ease, background-color .25s ease;
  will-change: transform, box-shadow;
}
#homeBtn img { transition: transform .25s ease; display:block; width:28px; height:28px; margin:auto; }

#homeBtn:hover{
  transform: translateY(-6px) scale(1.08);
  box-shadow: 0 12px 30px rgba(79,70,229,0.18), 0 4px 10px rgba(0,0,0,0.35), 0 0 14px rgba(244,63,94,0.10);
  background: linear-gradient(180deg, rgba(255,255,255,0.22), rgba(255,255,255,0.12));
}
#homeBtn:hover img{ transform: rotate(-8deg) scale(1.04); }

/* Subtle glowing ring animation */
#homeBtn::after{
  content: "";
  position: absolute;
  left: 50%; top: 50%;
  width: 90%; height: 90%;
  transform: translate(-50%,-50%) scale(1);
  border-radius: 50%;
  pointer-events: none;
  z-index: -1;
  background: radial-gradient(circle at center, rgba(79,70,229,0.18) 0%, rgba(244,63,94,0.06) 35%, transparent 60%);
  opacity: 0;
  transition: opacity .25s ease, transform .4s ease;
}
#homeBtn:hover::after{
  opacity: 1;
  transform: translate(-50%,-50%) scale(1.45);
  animation: pulseRing 900ms ease-out;
}

@keyframes pulseRing {
  0%   { transform: translate(-50%,-50%) scale(1);   opacity: .9;  }
  60%  { transform: translate(-50%,-50%) scale(1.9); opacity: .18; }
  100% { transform: translate(-50%,-50%) scale(2.6); opacity: 0;   }
}

/* Name prompt modal */
#namePrompt {
  position:fixed; top:0; left:0; width:100%; height:100%;
  background: rgba(0,0,0,0.6); backdrop-filter: blur(10px);
  display:flex; justify-content:center; align-items:center; z-index:50;
}
#nameBox {
  background: rgba(255,255,255,0.15); padding:40px; border-radius:30px;
  backdrop-filter: blur(20px); text-align:center; box-shadow:0 10px 40px rgba(0,0,0,0.4);
}
#nameBox h2 {margin-bottom:15px; color:white;}
#nameInput {padding:10px 15px; border:none; border-radius:10px; width:80%; font-size:16px; margin-bottom:15px;}
#saveNameBtn {padding:10px 20px; border:none; border-radius:10px; background:#4f46e5; color:white; cursor:pointer;}

/* Spotlight search */
#searchContainer {
  position:fixed;top:30px;left:50%;transform:translateX(-50%);z-index:50;width:400px;
}
#appSearch {
  width:100%;padding:10px 15px;border-radius:20px;border:none;font-size:16px;outline:none;
  box-shadow:0 5px 20px rgba(0,0,0,0.3);backdrop-filter: blur(10px);background:rgba(255,255,255,0.15);color:white;
}
#searchSuggestions {
  margin-top:5px;background:rgba(0,0,0,0.7);border-radius:10px;display:none;max-height:200px;overflow-y:auto;
}
#searchSuggestions div {padding:8px 12px;cursor:pointer;color:white;}
#searchSuggestions div:hover {background:rgba(255,255,255,0.2);}
</style>
</head>
<body>

<div id="clockContainer">
  <div id="clock">00:00:00</div>
  <div id="analogClock">
    <div class="hand hourHand"></div>
    <div class="hand minuteHand"></div>
    <div class="hand secondHand"></div>
  </div>
  <div id="welcomeName"></div>
</div>

<!-- Name prompt -->
<div id="namePrompt" style="display:none;">
  <div id="nameBox">
    <h2>Welcome! What's your name?</h2>
    <input type="text" id="nameInput" placeholder="Enter your name">
    <br>
    <button id="saveNameBtn">Save</button>
  </div>
</div>

<div id="settingsPanel">
  <h2 style="display:flex; align-items:center; gap:10px;">
    <img src="Icons/settings.svg" alt="Settings Logo" style="width:30px; height:30px;">
    Settings
  </h2>
  <label>Timezone:
    <select id="timezoneSelect">
      <option value="America/Chicago">Anna, Texas</option>
      <option value="UTC">UTC</option>
      <option value="America/New_York">New York</option>
      <option value="Europe/London">London</option>
      <option value="Asia/Tokyo">Tokyo</option>
    </select>
  </label>
  <label>Clock Format:
    <select id="formatSelect">
      <option value="12">12-hour</option>
      <option value="24">24-hour</option>
    </select>
  </label>
  <label>Clock Style:
    <select id="styleSelect">
      <option value="digital">Digital</option>
      <option value="analog">Analog</option>
    </select>
  </label>
  <label>Background:
    <select id="backgroundSelect">
      <option value="digitalLandscape">Digital Landscape</option>
      <option value="gradient1">Gradient 1</option>
      <option value="gradient2">Gradient 2</option>
      <option value="gradient3">Gradient 3</option>
      <option value="custom">Custom (Upload)</option>
    </select>
  </label>

  <!-- Hidden file input and preview for custom background -->
  <input type="file" id="backgroundUpload" accept="image/*" style="display:none;">
  <img id="bgPreview" alt="Background preview" style="display:none; width:100%; border-radius:12px; margin-top:10px; box-shadow:0 8px 30px rgba(0,0,0,0.4);">

  <script>
    (function(){
      const bgSelect = document.getElementById('backgroundSelect');
      const bgUpload = document.getElementById('backgroundUpload');
      const bgPreview = document.getElementById('bgPreview');

      function applyCustomBackground(dataUrl){
        if(!dataUrl) return;
        // persist the custom image and mark settings
        try {
          const s = JSON.parse(localStorage.getItem('desktopSettings') || '{}');
          s.background = 'custom';
          localStorage.setItem('desktopSettings', JSON.stringify(s));
        } catch (e) {}
        localStorage.setItem('customBackgroundImage', dataUrl);
        document.body.style.background = `url('${dataUrl}') center/cover no-repeat fixed`;
        document.body.style.backgroundAttachment = 'fixed';
        bgPreview.src = dataUrl;
        bgPreview.style.display = 'block';
      }

      // When user selects "Custom", immediately open file dialog
      bgSelect.addEventListener('change', () => {
        if (bgSelect.value === 'custom') {
          // trigger file picker
          bgUpload.click();
        } else {
          // hide preview for non-custom choices
          bgPreview.style.display = 'none';
        }
      });

      // Handle file selection and read as DataURL
      bgUpload.addEventListener('change', (e) => {
        const file = e.target.files && e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (ev) => {
          applyCustomBackground(ev.target.result);
        };
        reader.readAsDataURL(file);
      });

      // On page load, if settings indicate a custom background, apply stored image
      window.addEventListener('load', () => {
        try {
          const s = JSON.parse(localStorage.getItem('desktopSettings') || '{}');
          const img = localStorage.getItem('customBackgroundImage');
          if (s.background === 'custom' && img) {
            // ensure the select shows custom
            bgSelect.value = 'custom';
            applyCustomBackground(img);
          }
        } catch (e) {}
      });
    })();
  </script>
  <label>App Icon Style:
    <select id="appStyleSelect">
      <option value="light">Light</option>
      <option value="mirror">Mirror</option>
      <option value="black">Black</option>
    </select>
  </label>
</div>

<iframe id="iframeView"></iframe>

<div id="creditsView">
  <h1>Credits</h1>
  <p>Special thanks to everyone who contributed:</p>
  <ul>
    <li>Emilio ‚Äì SVG design</li>
    <li>Tsukki ‚Äì Concept and Implementation</li>
  </ul>
  <p>Made using HTML, CSS, and JavaScript. <br><br> Please Reload After Closing This.</p>
  <button id="closeCredits">Close</button>
</div>

<!-- Spotlight Search -->
<div id="searchContainer">
  <input type="text" id="appSearch" placeholder="Type to search apps...">
  <div id="searchSuggestions"></div>
</div>

<!-- Fullscreen toggle (adds a red-square button to the dock and enables a clean fullscreen wallpaper view) -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  const dock = document.getElementById('dock');
  if (!dock) return;

  dock.appendChild(fsBtn);

  function enableCleanFullscreen() {
    // visually hide UI elements but keep background visible
    document.body.classList.add('fullscreen-mode');
    // request fullscreen for the whole document
    if (document.documentElement.requestFullscreen) {
      document.documentElement.requestFullscreen().catch(()=>{/* ignore */});
    }
  }

  function disableCleanFullscreen() {
    document.body.classList.remove('fullscreen-mode');
    if (document.fullscreenElement) {
      document.exitFullscreen && document.exitFullscreen().catch(()=>{/* ignore */});
    }
  }

  fsBtn.addEventListener('click', () => {
    if (!document.fullscreenElement) enableCleanFullscreen();
    else disableCleanFullscreen();
  });

  // Keep UI state in sync with native fullscreen changes (Esc or other triggers)
  document.addEventListener('fullscreenchange', () => {
    if (!document.fullscreenElement) {
      // exited fullscreen
      document.body.classList.remove('fullscreen-mode');
    } else {
      // entered fullscreen (could be via F11 or other)
      document.body.classList.add('fullscreen-mode');
    }
  });

  // If user presses Esc and for some reason class remains, ensure cleanup
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && !document.fullscreenElement) {
      document.body.classList.remove('fullscreen-mode');
    }
  });
});
</script>

<style>
/* Smooth transitions and hide everything except wallpaper when in fullscreen-mode */
.fullscreen-mode #dock,
.fullscreen-mode #clockContainer,
.fullscreen-mode #settingsPanel,
.fullscreen-mode #iframeView,
.fullscreen-mode #searchContainer,
.fullscreen-mode #homeBtn,
.fullscreen-mode #creditsView,
.fullscreen-mode #namePrompt {
  opacity: 0;
  pointer-events: none;
  transform: translateY(8px) scale(.995);
  transition: opacity .45s ease, transform .45s ease;
}

/* Ensure the background stays visible and transitions smoothly */
html, body {
  transition: background .6s ease, opacity .45s ease;
}

/* Hide iframe forcibly in fullscreen-mode to avoid any content overlay */
.fullscreen-mode #iframeView { display: none !important; }

/* Slight visual polish for the added dock button */
#fullscreenDockBtn:hover { transform: translateY(-6px) scale(1.06); box-shadow:0 10px 25px rgba(255,255,255,0.9); }
</style>
<div id="dock">
  <div class="dock-app app-light" data-app="Browser" data-url="TokiMate://Browser" title="Browser">üñ•Ô∏è</div>
  <div class="dock-app app-light" data-app="Mail" data-url="TokiMate://Mail" title="Mail">üìß</div>
  <div class="dock-app app-light" data-app="Music" data-url="TokiMate://Music" title="Music">
    <img src="Icons/music_player.svg" alt="Music" style="width:48px;height:48px;pointer-events:none;object-fit:contain;">
  </div>
  <div class="dock-app app-light" data-app="Photos" data-url="TokiMate://Photos" title="Photos">
    <img src="Icons/Pictures_icon.svg" alt="Photos" style="width:48px;height:48px;pointer-events:none;object-fit:contain;">
  </div>
  <div class="dock-app app-light" data-app="Skribbl" data-url="TokiMate://Skribbl" title="Skribbl">
    <img src="Icons/Skribbl_icon.svg" alt="Skribbl" style="width:48px;height:48px;pointer-events:none;object-fit:contain;">
  </div>
  <div class="dock-app app-light" data-app="Credits" data-url="credits" title="Credits">‚ÑπÔ∏è</div>

  <!-- Fullscreen button added directly to the dock -->
  <div class="dock-app app-black" id="fullscreenDockBtn" data-url="fullscreen" title="Toggle Fullscreen">üü•</div>
</div>

<button id="homeBtn" title="Home">
  <img src="file:///home/chronos/u-b4b0dbb2709dbb80bc8404e880fc7f79a6796c7c/MyFiles/Downloads/TokiMate/index.html" alt="Home" style="width:28px;height:28px;display:block;margin:auto;">
</button>

<script>
(function(){
  const fsBtn = document.getElementById('fullscreenDockBtn');
  if(!fsBtn) return;

  function enableCleanFullscreen() {
    document.body.classList.add('fullscreen-mode');
    if (document.documentElement.requestFullscreen) {
      document.documentElement.requestFullscreen().catch(()=>{/* ignore */});
    }
  }

  function disableCleanFullscreen() {
    document.body.classList.remove('fullscreen-mode');
    if (document.fullscreenElement) {
      document.exitFullscreen && document.exitFullscreen().catch(()=>{/* ignore */});
    }
  }

  fsBtn.addEventListener('click', () => {
    if (!document.fullscreenElement) enableCleanFullscreen();
    else disableCleanFullscreen();
  });

  // Keep UI state in sync with native fullscreen changes (Esc or other triggers)
  document.addEventListener('fullscreenchange', () => {
    if (!document.fullscreenElement) {
      document.body.classList.remove('fullscreen-mode');
    } else {
      document.body.classList.add('fullscreen-mode');
    }
  });

  // If user presses Esc and for some reason class remains, ensure cleanup
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && !document.fullscreenElement) {
      document.body.classList.remove('fullscreen-mode');
    }
  });
})();
</script>

<script>
window.addEventListener('load', () => document.body.style.opacity = '1');

// Clock and Analog Hands
const clock=document.getElementById('clock');
const analogClock=document.getElementById('analogClock');
const hourHand=analogClock.querySelector('.hourHand');
const minuteHand=analogClock.querySelector('.minuteHand');
const secondHand=analogClock.querySelector('.secondHand');

const clockContainer=document.getElementById('clockContainer');
const settingsPanel=document.getElementById('settingsPanel');
const timezoneSelect=document.getElementById('timezoneSelect');
const formatSelect=document.getElementById('formatSelect');
const styleSelect=document.getElementById('styleSelect');
const backgroundSelect=document.getElementById('backgroundSelect');
const appStyleSelect=document.getElementById('appStyleSelect');
const iframeView=document.getElementById('iframeView');
const dock=document.getElementById('dock');
const dockApps=document.querySelectorAll('.dock-app');
const homeBtn=document.getElementById('homeBtn');
const creditsView=document.getElementById('creditsView');
const closeCreditsBtn=document.getElementById('closeCredits');
const welcomeName=document.getElementById('welcomeName');
const namePrompt=document.getElementById('namePrompt');
const nameInput=document.getElementById('nameInput');
const saveNameBtn=document.getElementById('saveNameBtn');

let userName=localStorage.getItem('userName');
if(!userName){namePrompt.style.display='flex';}else{welcomeName.textContent=`Welcome, ${userName}!`;}

saveNameBtn.addEventListener('click',()=>{
  const val=nameInput.value.trim();
  if(val){localStorage.setItem('userName',val);userName=val;welcomeName.textContent=`Welcome, ${userName}!`;namePrompt.style.display='none';}
});

// Settings
let settings={timezone:'America/Chicago',format:'24',style:'digital',background:'digitalLandscape',appStyle:'light'};
const savedSettings=localStorage.getItem('desktopSettings');if(savedSettings){settings={...settings,...JSON.parse(savedSettings)};}

timezoneSelect.value=settings.timezone;formatSelect.value=settings.format;styleSelect.value=settings.style;
backgroundSelect.value=settings.background;appStyleSelect.value=settings.appStyle;

function updateClock(){
  const now=new Date();
  const options={timeZone:settings.timezone,hour12:settings.format==='12',hour:'2-digit',minute:'2-digit',second:'2-digit'};
  clock.textContent=now.toLocaleTimeString('en-US',options);
  const local=new Date(now.toLocaleString('en-US',{timeZone:settings.timezone}));
  const h=local.getHours()%12,m=local.getMinutes(),s=local.getSeconds();
  hourHand.style.transform=`rotate(${h*30+m/2}deg)`;minuteHand.style.transform=`rotate(${m*6}deg)`;secondHand.style.transform=`rotate(${s*6}deg)`;
}
setInterval(updateClock,1000);updateClock();

const gifBackgrounds = [
  "https://images.steamusercontent.com/ugc/271725310716427808/FA3288AF961AFFFDC71DB99058354F1159943C09/?imw=5000&imh=5000&ima=fit&impolicy=Letterbox&imcolor=%23000000&letterbox=false",
  "https://windowscustomization.com/wp-content/uploads/2019/02/Wallpaper.gif",
  "https://windowscustomization.com/wp-content/uploads/2018/12/Anime-And-Scape-Watefal.gif",
  "https://wallpaperaccess.com/full/9336992.gif",
  "https://i.redd.it/x4hnwsvps4h91.gif"
];

function applySettings(){
  localStorage.setItem('desktopSettings', JSON.stringify(settings));
  clock.style.display = settings.style === 'digital' ? 'block' : 'none';
  analogClock.style.display = settings.style === 'analog' ? 'block' : 'none';
  const b = settings.background;
  document.body.style.transition = 'background 0.8s ease-in-out, opacity 0.8s ease-in-out';
  document.body.style.backgroundAttachment = 'fixed';
  if (b === 'digitalLandscape') {
    const randomGif = gifBackgrounds[Math.floor(Math.random() * gifBackgrounds.length)];
    document.body.style.background = `url('${randomGif}') center/cover no-repeat fixed`;
  } else if (b === 'gradient1') {
    document.body.style.background = "linear-gradient(135deg,#667eea,#764ba2)";
  } else if (b === 'gradient2') {
    document.body.style.background = "linear-gradient(135deg,#ff9a9e,#fad0c4)";
  } else if (b === 'gradient3') {
    document.body.style.background = "linear-gradient(135deg,#43cea2,#185a9d)";
  }
  dockApps.forEach(app => {
    app.classList.remove('app-light','app-mirror','app-black');
    app.classList.add(`app-${settings.appStyle}`);
  });
}
applySettings();

[timezoneSelect,formatSelect,styleSelect,backgroundSelect,appStyleSelect].forEach(sel=>{
  sel.addEventListener('change',()=>{settings[sel.id.replace('Select','')]=sel.value;applySettings();});
});

// Apps
const appSearch=document.getElementById('appSearch');
const searchSuggestions=document.getElementById('searchSuggestions');

const apps = [
  {name:'Browser', url:'TokiMate://Browser'},
  {name:'Mail', url:'TokiMate://Mail'},
  {name:'Music', url:'TokiMate://Music'},
  {name:'Photos', url:'TokiMate://Photos'},
  {name:'Skribbl', url:'TokiMate://Skribbl'},
  {name:'Credits', url:'credits'}
];

function getAppURL(appName){
  switch(appName){
    case 'Browser': return 'https://www.google.com';
    case 'Mail': return 'https://mail.google.com';
    // Open local mp3.html instead of redirecting to music.youtube.com
    case 'Music': return 'file:///home/Slimee5661/Documents/Aqua%20The%20Failure/Resources/mp3.html';
    case 'Photos': return 'https://photos.google.com';
    case 'Skribbl': return 'https://skribbl.io';
    default: return '';
  }
}

function openApp(url){
  if(url==='credits'){
    creditsView.style.display='block';
    dock.style.display = 'none';
    clockContainer.style.display = 'none';
    settingsPanel.style.display = 'none';
    appSearch.parentElement.style.display = 'none';
    homeBtn.style.display='block';
    return;
  }
  if(url.startsWith('TokiMate://')){
    const appName = url.replace('TokiMate://','');
    const appData = apps.find(a=>a.name===appName);
    if(appData){
      iframeView.src = getAppURL(appName);
      iframeView.style.display='block';
      homeBtn.style.display='block';
      dock.style.display = 'none';
      clockContainer.style.display = 'none';
      settingsPanel.style.display = 'none';
      appSearch.parentElement.style.display = 'none';
    }
  }
}

// Dock clicks
dockApps.forEach(app=>{
  app.addEventListener('click',()=>openApp(app.dataset.url));
});

// Home button restores everything
homeBtn.addEventListener('click',()=>{
  iframeView.style.display='none';
  homeBtn.style.display='none';
  dock.style.display = 'flex';
  clockContainer.style.display = 'flex';
  appSearch.parentElement.style.display = 'block';
});

// Credits close
closeCreditsBtn.addEventListener('click', () => {
    creditsView.style.display = 'none';
    // Restore main UI elements
    clockContainer.style.display = 'flex';
    dock.style.display = 'flex';
    searchContainer.style.display = 'block';
    iframeView.style.display = 'none';
    homeBtn.style.display = 'none';
});

// Settings toggle
clockContainer.addEventListener('click', () => {
    // Only toggle settings if iframe is not open
    if (iframeView.style.display !== 'block') {
        settingsPanel.classList.toggle('active');
    }
});

// Spotlight search
appSearch.addEventListener('input', () => {
  const val = appSearch.value.toLowerCase().trim();
  searchSuggestions.innerHTML = '';
  if(val.length === 0){searchSuggestions.style.display='none'; return;}
  
  const filtered = apps.filter(app => app.name.toLowerCase().includes(val));
  if(filtered.length === 0){searchSuggestions.style.display='none'; return;}
  
  filtered.forEach(app => {
    const div = document.createElement('div');
    div.textContent = app.name;
    div.addEventListener('click', () => {
      // Autofill with TokiMate:// prefix
      appSearch.value = `TokiMate://${app.name}`;
      searchSuggestions.style.display='none';
    });
    searchSuggestions.appendChild(div);
  });
  searchSuggestions.style.display='block';
});

appSearch.addEventListener('keydown', e => {
  if(e.key==='Enter'){
    const val = appSearch.value.trim();
    // Only open if starts with TokiMate://
    if(val.startsWith('TokiMate://')){
      const appName = val.replace('TokiMate://','');
      const match = apps.find(a=>a.name.toLowerCase()===appName.toLowerCase());
      if(match) openApp(match.url);
    }
    searchSuggestions.style.display='none';
  }
});

</script>
</body>
</html>
