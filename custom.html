<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ubble.IDV Demo (Standalone / Offline)</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; padding: 24px; background:#f7f8fb; color:#111; }
    main { max-width:900px; margin:0 auto; background:white; padding:20px; border-radius:12px; box-shadow:0 6px 20px rgba(20,30,60,0.08); }
    h1 { margin-top:0; font-size:20px; }
    #iframe { display:block; margin: 12px 0; border: 1px solid #ddd; border-radius:8px; overflow:hidden; }
    .controls { margin-top:12px; }
    button { padding:8px 12px; border-radius:8px; border:1px solid #cfcfcf; background:#fff; cursor:pointer; }
    .log { margin-top:12px; padding:10px; background:#0f172a05; border-radius:8px; font-family:monospace; font-size:13px; white-space:pre-wrap; min-height:48px; }
    .note { color:#555; font-size:13px; margin-top:8px; }
  </style>
</head>
<body>
  <main>
    <h1>Ubble.IDV Demo (Standalone / Offline)</h1>

    <p class="note">This page demonstrates creating an <code>Ubble.IDV</code> instance and attaching it to a local element. The page contains a small offline mock implementation so it works without external scripts. Replace the mock with the real Ubble script when you're ready to integrate online.</p>

    <!-- target element as in your snippet -->
    <div id="iframe" style="width:600px; height:500px;"></div>

    <div class="controls">
      <button id="initBtn">Initialize Ubble.IDV</button>
      <button id="abortBtn">Simulate Abort</button>
    </div>

    <div class="log" id="log">log: (nothing yet)</div>

    <script>
      // Helper to append to the log area
      function log(msg) {
        const l = document.getElementById('log');
        const time = new Date().toLocaleTimeString();
        l.textContent += `\n[${time}] ${msg}`;
        l.scrollTop = l.scrollHeight;
      }

      /************************************************************************
       * OFFLINE MOCK for Ubble.IDV
       * - This mock only exists so the page works when offline.
       * - When integrating the real Ubble library, REMOVE or comment out this mock
       *   and include Ubble's official script per their documentation.
       ************************************************************************/
      (function provideOfflineMockIfNeeded() {
        if (window.Ubble && window.Ubble.IDV) {
          // Real Ubble already present — do nothing.
          return;
        }

        // Minimal, friendly mock that simulates flow and events.
        window.Ubble = window.Ubble || {};
        window.Ubble.IDV = class {
          constructor(target, opts = {}) {
            // accept either element or element markup (your original used <div id="iframe"></div>)
            if (typeof target === 'string') {
              this.container = document.querySelector(target);
            } else if (target instanceof HTMLElement) {
              this.container = target;
            } else {
              this.container = document.getElementById('iframe');
            }

            this.opts = opts;
            this._render();
            // If the user provided event callbacks, store them
            this.events = (opts && opts.events) || {};
            log('Mock Ubble.IDV created. identificationUrl: ' + (opts.identificationUrl || 'N/A'));
          }

          _render() {
            // create a simple simulated iframe area with some controls
            const c = this.container;
            c.innerHTML = '';
            c.style.width = (this.opts.width ? this.opts.width + 'px' : '600px');
            c.style.height = (this.opts.height ? this.opts.height + 'px' : '500px');
            c.style.display = 'flex';
            c.style.alignItems = 'center';
            c.style.justifyContent = 'center';
            c.style.background = '#fff';
            c.style.position = 'relative';

            const box = document.createElement('div');
            box.style.textAlign = 'center';
            box.style.padding = '18px';
            box.style.borderRadius = '8px';
            box.style.boxShadow = '0 6px 18px rgba(16,24,40,0.06)';
            box.innerHTML = `
              <div style="font-weight:600; margin-bottom:8px">Ubble.IDV (offline mock)</div>
              <div style="font-size:13px; color:#555; margin-bottom:12px">identificationUrl: <span style="font-family:monospace">${this.opts.identificationUrl || ''}</span></div>
              <div>
                <button id="mockComplete" style="margin-right:8px;padding:6px 10px;">Complete</button>
                <button id="mockAbort" style="padding:6px 10px;">Abort</button>
              </div>
            `;
            c.appendChild(box);

            // hook buttons
            box.querySelector('#mockComplete').addEventListener('click', () => {
              log('Mock: user clicked Complete button');
              if (typeof this.events.onComplete === 'function') {
                try { this.events.onComplete({ status: 'ok', mock: true }); } catch (e) { console.error(e); }
              }
            });
            box.querySelector('#mockAbort').addEventListener('click', () => {
              log('Mock: user clicked Abort button');
              if (typeof this.events.onAbort === 'function') {
                try { this.events.onAbort({ status: 'aborted', mock: true }); } catch (e) { console.error(e); }
              }
            });
          }

          // Example methods you might expect
          destroy() {
            if (this.container) this.container.innerHTML = '';
            log('Mock Ubble.IDV destroyed');
          }
        };
        log('Offline mock for Ubble.IDV installed (page is offline-friendly).');
      })();

      /************************************************************************
       * YOUR USAGE: this block demonstrates exactly how to call the API you
       * provided. It uses document.getElementById(...) as the first argument
       * (recommended) rather than an inline node in the constructor parameter.
       ************************************************************************/
      let ubbleInstance = null;

      function initUbble() {
        // initialize using your exact config — adapted slightly to pass element ref
        ubbleInstance = new Ubble.IDV(document.getElementById('iframe'), {
          identificationUrl: "https://hianime.to/",
          height: "500",
          width: "600",
          allowCamera: false,
          events: {
            onComplete: (info) => {
              // your onComplete handler
              log('onComplete fired — info: ' + JSON.stringify(info));
              // ... additional app logic would go here
            },
            onAbort: (info) => {
              // your onAbort handler
              log('onAbort fired — info: ' + JSON.stringify(info));
              // ... additional app logic would go here
            }
          }
        });
      }

      // UI buttons
      document.getElementById('initBtn').addEventListener('click', () => {
        if (ubbleInstance) {
          log('Ubble already initialized; destroying previous instance and re-initializing.');
          if (typeof ubbleInstance.destroy === 'function') ubbleInstance.destroy();
          ubbleInstance = null;
        }
        initUbble();
      });

      document.getElementById('abortBtn').addEventListener('click', () => {
        if (ubbleInstance && ubbleInstance.events && typeof ubbleInstance.events.onAbort === 'function') {
          // simulate abort event
          ubbleInstance.events.onAbort({ simulated: true });
        } else {
          log('No instance to abort or no onAbort handler present.');
        }
      });

      // auto-initialize on first load for convenience
      // (comment this line out if you prefer manual init)
      initUbble();

      /************************************************************************
       * If you later add the real Ubble script, you would typically do:
       *
       * <script src="https://path.to/ubble/sdk.js"></script>
       * and then:
       * new Ubble.IDV(document.getElementById('iframe'), { ... });
       *
       * Make sure to remove or disable the offline mock above when using the real sdk.
       ************************************************************************/
    </script>
  </main>
</body>
</html>
